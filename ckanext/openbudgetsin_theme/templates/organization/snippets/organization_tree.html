{#
Displays a tree of organzations

NB This template can be slow because it is recursive and uses link_for. At
DGU we speeded up display of the tree 10 times (necessary as we have 1000 
organizations) by replacing this template with a recursive code routine:
https://github.com/datagovuk/ckanext-dgu/blob/5fb78b354517c2198245bdc9c98fb5d6c82c6bcc/ckanext/dgu/lib/helpers.py#L140 

orgs    - List of organizations

Example:

  {% snippet 'organization/snippets/organization_tree.html', top_nodes=h.group_tree(type_='organization'), use_longnames=False %}

#}


{% resource 'openbudgetsin_theme/level_of_gov.css' %}

{% set type = node.type or 'organization' %}
{% set url = h.url_for(type ~ '_read', action='read', id=node.name) %}

{% block item %}
<li class="media-item" style="margin: 0 0 1em 0;">
  <div class="row-fluid">
  {% block item_inner scoped %}

    {% set longname = h.group_tree_get_longname(node.name) %} 
    {% set display_text = node.title %} 
    {% if use_longnames and longname%}
      {% set display_text = longname + " (" + display_text + ")" %}
    {% endif %} 
  
    {% if node.children %}

      <div class="span2">
        <img src="{{ node.image_display_url or h.url_for_static('/base/images/placeholder-organization.png') }}" alt="{{ node.name }}" class="media-image">
      </div>
    
      <div class="span10">
        <div class="row-fluid">
          <div class="span12">
              <h4 class="media-head">
                  {% link_for display_text, controller='organization', action='read', id=node.name %}
               </h4>

                  <span style="margin: 0 10px;">|</span>

            {% if node.package_count %}
              <strong class="count">{{ ungettext('{num} Dataset', '{num} Datasets', node.package_count).format(num=node.package_count) }} found</strong>
            {% else %}
              <span class="count">{{ _('0 Datasets found') }}</span>
            {% endif %}

          </div>
        </div>

        <div class="row-fluid">
          <div class="span12 no-padding-left">
          {% if node.description %}
            <p>{{ h.markdown_extract(node.description) }}</p>
          {% endif %}
          </div>
        </div>

        {% set j = 0 %} 
        {% for i in range(2) %}
        <div class="row-fluid">
          {% if i == 1 %}
            {% set n = j+2 %} 
          {% else %}
            {% set n = j+3 %} 
          {% endif %}

          {% for child in node.children[j:n] %}
          <div class="span4 no-padding">
            {% set child_node = child %}
            {% if child_node %}
              {% link_for child_node.title, controller='organization', action='read', id=child_node.name %}
            {% endif %}
          </div>

          {% endfor %}

          {% if i == 1 %}
          <div class="span4 no-padding pull-right">
            {% link_for "see more...", controller='organization', action='read', id=node.name %}
          </div>
          {% endif %}

          {% set j = j+3 %} 
        </div>
        {% endfor %}

      </div>

    {% endif %}
    
  {% endblock %}

  </div>
</li>
{% endblock %}
